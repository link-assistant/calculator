{"additions":615,"author":{"id":"MDQ6VXNlcjE0MzE5MDQ=","is_bot":false,"login":"konard","name":"Konstantin Diachenko"},"baseRefName":"main","body":"## Summary\n\nThis PR enhances the release scripts to support both single-language and multi-language repository structures by adding automatic package root detection.\n\n**New utility modules:**\n- `scripts/js-paths.mjs` - JavaScript package root detection\n- `scripts/rust-paths.mjs` - Rust package root detection\n\n**Updated scripts:**\n- `scripts/version-and-commit.mjs`\n- `scripts/instant-version-bump.mjs`\n- `scripts/publish-to-npm.mjs`\n- `scripts/rust-version-and-commit.mjs`\n- `scripts/rust-collect-changelog.mjs`\n- `scripts/rust-get-bump-type.mjs`\n\n## How It Works\n\nThe utilities automatically detect the package root:\n\n1. **Single-language repository**: Check for `./package.json` or `./Cargo.toml` in root\n2. **Multi-language repository**: Check for `./js/package.json` or `./rust/Cargo.toml`\n3. If neither exists, throw an error with helpful suggestions\n\n### Configuration Options\n\nScripts support explicit configuration via:\n- CLI arguments: `--js-root <path>` or `--rust-root <path>`\n- Environment variables: `JS_ROOT` or `RUST_ROOT`\n\n### Example Usage\n\n```bash\n# Auto-detection (default)\nnode scripts/version-and-commit.mjs --mode changeset\n\n# Explicit configuration\nnode scripts/version-and-commit.mjs --mode changeset --js-root js\n\n# Via environment variable\nJS_ROOT=js node scripts/version-and-commit.mjs --mode changeset\n```\n\n## Root Cause (Original Issue)\n\nThe original issue (#113) was that `command-stream` library's `cd` command calls `process.chdir()`, which permanently changes the working directory. This caused file operations to fail after running commands like `cd js && npm run ...`.\n\nThis PR addresses the issue comprehensively by:\n1. âœ… Preserving and restoring the working directory after `cd` commands (previous fix)\n2. âœ… Adding auto-detection of package root to support both repo structures (this enhancement)\n\n## Test Plan\n\n- [x] Verified syntax check passes for all modified scripts\n- [x] Tested `js-paths.mjs` utility - correctly detects `js/` as package root\n- [x] Tested `rust-paths.mjs` utility - correctly detects `rust/` as package root\n- [ ] Verify CI pipeline passes\n- [ ] Manual test in a single-language repository (optional)\n\nFixes #113\n\n---\nðŸ¤– Generated with [Claude Code](https://claude.com/claude-code)","comments":[{"id":"IC_kwDOQYTy3M7eiuo0","author":{"login":"konard"},"authorAssociation":"MEMBER","body":"## ðŸ¤– Solution Draft Log\nThis log file contains the complete execution trace of the AI solution draft process.\n\nðŸ’° **Cost estimation:**\n- Public pricing estimate: $5.396049 USD\n- Calculated by Anthropic: $3.198203 USD\n- Difference: $-2.197846 (-40.73%)\nðŸ“Ž **Log file uploaded as GitHub Gist** (561KB)\nðŸ”— [View complete solution draft log](https://gist.githubusercontent.com/konard/cf310db68d1ace851764202b38f809fa/raw/ad252e754e160d857ab82a4fc691510e8bf77e9f/solution-draft-log-pr-1768085575316.txt)\n---\n*Now working session is ended, feel free to review and add any feedback on the solution draft.*","createdAt":"2026-01-10T22:53:00Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/link-assistant/agent/pull/114#issuecomment-3733645876","viewerDidAuthor":true},{"id":"IC_kwDOQYTy3M7eivJa","author":{"login":"konard"},"authorAssociation":"MEMBER","body":"I think in all JavaScript related scripts we need to have configurable repository root, that will be automatically determined if not specified. We should check for repository root `./package.json` and also `./js/package.json` by default.\r\n\r\nSo if not in root, try to search in js folder, if that also don't exist throw an error, and suggest user to configure the root folder explicitly.\r\n\r\nThat way scripts will support both single language repository and multi language repositories.\r\n\r\nWe can also do similar thing for Rust .mjs scripts.","createdAt":"2026-01-10T22:56:16Z","includesCreatedEdit":true,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/link-assistant/agent/pull/114#issuecomment-3733647962","viewerDidAuthor":true},{"id":"IC_kwDOQYTy3M7eivR_","author":{"login":"konard"},"authorAssociation":"MEMBER","body":"ðŸ¤– **AI Work Session Started**\n\nStarting automated work session at 2026-01-10T22:57:08.495Z\n\nThe PR has been converted to draft mode while work is in progress.\n\n_This comment marks the beginning of an AI work session. Please wait working session to finish, and provide your feedback._","createdAt":"2026-01-10T22:57:10Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/link-assistant/agent/pull/114#issuecomment-3733648511","viewerDidAuthor":true},{"id":"IC_kwDOQYTy3M7eiy3o","author":{"login":"konard"},"authorAssociation":"MEMBER","body":"## ðŸ¤– Solution Draft Log\nThis log file contains the complete execution trace of the AI solution draft process.\n\nðŸ’° **Cost estimation:**\n- Public pricing estimate: $5.270661 USD\n- Calculated by Anthropic: $3.049357 USD\n- Difference: $-2.221304 (-42.14%)\nðŸ“Ž **Log file uploaded as GitHub Gist** (612KB)\nðŸ”— [View complete solution draft log](https://gist.githubusercontent.com/konard/08328f143f1dfaee30edf6160e8bcb98/raw/1cec9c53daaa224d5a5d4fe32883410d957ea421/solution-draft-log-pr-1768086455505.txt)\n---\n*Now working session is ended, feel free to review and add any feedback on the solution draft.*","createdAt":"2026-01-10T23:07:39Z","includesCreatedEdit":false,"isMinimized":false,"minimizedReason":"","reactionGroups":[],"url":"https://github.com/link-assistant/agent/pull/114#issuecomment-3733663208","viewerDidAuthor":true}],"createdAt":"2026-01-10T22:42:12Z","deletions":30,"files":[{"path":"docs/case-studies/issue-113/README.md","additions":111,"deletions":0},{"path":"scripts/instant-version-bump.mjs","additions":38,"deletions":5},{"path":"scripts/js-paths.mjs","additions":159,"deletions":0},{"path":"scripts/publish-to-npm.mjs","additions":41,"deletions":8},{"path":"scripts/rust-collect-changelog.mjs","additions":25,"deletions":4},{"path":"scripts/rust-get-bump-type.mjs","additions":12,"deletions":1},{"path":"scripts/rust-paths.mjs","additions":169,"deletions":0},{"path":"scripts/rust-version-and-commit.mjs","additions":17,"deletions":4},{"path":"scripts/version-and-commit.mjs","additions":43,"deletions":8}],"headRefName":"issue-113-e95eec3e2b2f","mergedAt":"2026-01-10T23:07:46Z","number":114,"reviews":[],"state":"MERGED","title":"feat: Add configurable package root for release scripts"}
